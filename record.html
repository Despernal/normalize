<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Defining Records - normalize.record &mdash; normalize 0.4.4 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.4.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="normalize 0.4.4 documentation" href="index.html" />
    <link rel="next" title="Referring to components of Records - normalize.selector" href="selector.html" />
    <link rel="prev" title="Defining Properties - normalize.property" href="property.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="selector.html" title="Referring to components of Records - normalize.selector"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="property.html" title="Defining Properties - normalize.property"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">normalize 0.4.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="defining-records-normalize-record">
<h1>Defining Records - <tt class="docutils literal"><span class="pre">normalize.record</span></tt><a class="headerlink" href="#defining-records-normalize-record" title="Permalink to this headline">¶</a></h1>
<div class="section" id="record-flavors">
<h2>Record Flavors<a class="headerlink" href="#record-flavors" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">Record</span></tt> subclasses don&#8217;t have any special mix-in magic like
<tt class="docutils literal"><span class="pre">Property</span></tt> subclasses do.  To use a <tt class="docutils literal"><span class="pre">Record</span></tt> subclass you must
explicitly derive it.  The most useful classes for general use are
<tt class="xref py py-class docutils literal"><span class="pre">normalize.record.json.JsonRecord</span></tt>,
<tt class="xref py py-class docutils literal"><span class="pre">normalize.record.RecordList</span></tt> and the combination,
<tt class="xref py py-class docutils literal"><span class="pre">normalize.record.json.JsonRecordList</span></tt>.</p>
<p>Here&#8217;s a guide to choosing a class:</p>
<p><tt class="docutils literal"><span class="pre">JsonRecord</span></tt></p>
<blockquote>
<div><p>This is a good choice for codebases where you typically want to
pass the JSON (string or data) as the first positional argument to
a constructor.  There is one JSON mapping which is the default,
and it is accessed by <tt class="docutils literal"><span class="pre">.json_data()</span></tt> (or the constructor).  It
also has an <tt class="docutils literal"><span class="pre">unknown_json_keys</span></tt> property, which is is marked as
&#8216;extraneous&#8217; and contains all of the input keys which were not
known.</p>
<p>The specifics of this conversion can be overridden in many ways;
you can set <tt class="docutils literal"><span class="pre">json_name</span></tt> on the property name to override the
default of using the python property name.  You can also provide
<tt class="docutils literal"><span class="pre">json_in</span></tt> and <tt class="docutils literal"><span class="pre">json_out</span></tt> lambda functions to transform the
values on the way in and out.</p>
<p>More &#8216;radical&#8217; transforms can be achieved by overriding
<tt class="docutils literal"><span class="pre">json_data</span></tt> in your class for marshal out, and
<tt class="docutils literal"><span class="pre">json_to_initkwargs</span></tt> for marshall in.</p>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">Record</span></tt></p>
<blockquote>
<div><p>This version is a good choice where the sources of data are
typically other python functions.  The default is a conversion
from a dict, but the keys are the actual property names, not the
<tt class="docutils literal"><span class="pre">json_name</span></tt> versions like <tt class="docutils literal"><span class="pre">JsonRecord</span></tt>.</p>
<p>It&#8217;s also good for object types which have multiple JSON mappings,
where you don&#8217;t want to make any of them more special than any
other.  Instead of using the <tt class="docutils literal"><span class="pre">.json_data()</span></tt> function, you might
for instance be using <tt class="xref py py-class docutils literal"><span class="pre">normalize.visitor.Visitor</span></tt>.</p>
<p>You can still access the same conversion as with <tt class="docutils literal"><span class="pre">JsonRecord</span></tt> by
using the <tt class="xref py py-func docutils literal"><span class="pre">normalize.record.json.to_json()</span></tt> and
<tt class="xref py py-func docutils literal"><span class="pre">normalize.record.json.from_json()</span></tt> functions directly.
These functions will respect any <tt class="xref py py-class docutils literal"><span class="pre">JsonProperty</span></tt> hints
(<tt class="docutils literal"><span class="pre">json_name</span></tt> etc), even if those hints are on properties which
are not a part of a <tt class="docutils literal"><span class="pre">JsonRecord</span></tt> class.</p>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">RecordList</span></tt></p>
<blockquote>
<div><p>The <tt class="docutils literal"><span class="pre">RecordList</span></tt> type is a specialization of <tt class="docutils literal"><span class="pre">Record</span></tt>, which
expects its first constructor argument to be a list.  Internally
this is just a <tt class="docutils literal"><span class="pre">Record</span></tt> which has a <tt class="docutils literal"><span class="pre">values</span></tt> property, and
this property is the actual collection.  This <tt class="docutils literal"><span class="pre">values</span></tt> property
isn&#8217;t currently present in the <tt class="docutils literal"><span class="pre">type(Foo).properties</span></tt>
dictionary, but may some day show up there.</p>
<p>In theory, <tt class="docutils literal"><span class="pre">RecordList</span></tt> is just one of possibly many types of
<tt class="xref py py-class docutils literal"><span class="pre">normalize.coll.Collection</span></tt> sets which happens to use
continuous integers as the key.  Each collection type provides
methods which know how to interpret iterable things and convert
them into an iterable of (K, V) pairs.  In practice, the list is
the only type which is currently reasonably implemented or tested.</p>
<p>This base class implements the various methods expected of
collections (iterators, getitem, etc).  It mostly just passes
these down to the underlying <tt class="docutils literal"><span class="pre">values</span></tt>, but you can expect this
behavior to get more typesafe as time goes on (so that you can&#8217;t,
for instance, add records of the wrong type to a list).</p>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">JsonRecordList</span></tt></p>
<blockquote>
<div>This is really just a <tt class="docutils literal"><span class="pre">RecordList</span></tt> sub-type which uses
<tt class="docutils literal"><span class="pre">json_to_initkwargs</span></tt> to handle the conversion from and from a
list.  So by default, the constructor expects a list, and the
<tt class="docutils literal"><span class="pre">json_data</span></tt> method returns one, too.  You can also use this type
for when you&#8217;re dealing with Json data which is logically a list,
but actually is a dict, with some top-level keys, and one of the
keys with the list in it as well, by customizing the
<tt class="docutils literal"><span class="pre">json_to_initkwargs</span></tt> method.  eg, a &#8220;next page&#8221; URL key, resume
token, or a count of the size of the set.</div></blockquote>
<p>That&#8217;s a summary overview; apologies if I end up repeating myself over
the rest of this page!</p>
<div class="section" id="record">
<h3><tt class="docutils literal"><span class="pre">Record</span></tt><a class="headerlink" href="#record" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="collection-types">
<h3>Collection Types<a class="headerlink" href="#collection-types" title="Permalink to this headline">¶</a></h3>
<p>Collections are types of records, with a single property <tt class="docutils literal"><span class="pre">values</span></tt>
which contains the underlying collection object.</p>
</div>
<div class="section" id="jsonrecord">
<h3><tt class="docutils literal"><span class="pre">JsonRecord</span></tt><a class="headerlink" href="#jsonrecord" title="Permalink to this headline">¶</a></h3>
<div class="section" id="customizing-jsonrecord-marshalling">
<h4>Customizing JsonRecord Marshalling<a class="headerlink" href="#customizing-jsonrecord-marshalling" title="Permalink to this headline">¶</a></h4>
<p>JSON record marshalling can be overridden in two important ways:</p>
<ol class="arabic">
<li><p class="first">By specifying <tt class="docutils literal"><span class="pre">json_in</span></tt> (or just <tt class="docutils literal"><span class="pre">coerce</span></tt> if you want to be
able to pass in values like this from Python as well) and
<tt class="docutils literal"><span class="pre">json_out</span></tt> on your <tt class="docutils literal"><span class="pre">Properties</span></tt>, and the <tt class="docutils literal"><span class="pre">json_name</span></tt> key.</p>
<p>Remember, you don&#8217;t need to explicitly instantiate <tt class="docutils literal"><span class="pre">JsonProperty</span></tt>
objects; you can throw on these JSON specialization flags on any
property and <tt class="xref py py-mod docutils literal"><span class="pre">normalize.property.meta</span></tt> will mix them in for
you.</p>
<p>See <a class="reference internal" href="property.html#json"><em>Declaring JSON hints on Properties</em></a> for more details.</p>
</li>
<li><p class="first">Via the sub-class API.  The most convenient hooks are
<tt class="xref py py-meth docutils literal"><span class="pre">JsonRecord.json_to_initkwargs()</span></tt> (you must derive
<tt class="docutils literal"><span class="pre">JsonRecord</span></tt> for this) and <tt class="xref py py-meth docutils literal"><span class="pre">JsonRecord.json_data()</span></tt> (any
class can define this).  This is a more general API which can perform
more &#8216;drastic&#8217; conversions, for instance if you want to marshall your
class to a JSON Array.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="record-metaclass">
<h2>Record MetaClass<a class="headerlink" href="#record-metaclass" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Defining Records - <tt class="docutils literal"><span class="pre">normalize.record</span></tt></a><ul>
<li><a class="reference internal" href="#record-flavors">Record Flavors</a><ul>
<li><a class="reference internal" href="#record"><tt class="docutils literal"><span class="pre">Record</span></tt></a></li>
<li><a class="reference internal" href="#collection-types">Collection Types</a></li>
<li><a class="reference internal" href="#jsonrecord"><tt class="docutils literal"><span class="pre">JsonRecord</span></tt></a><ul>
<li><a class="reference internal" href="#customizing-jsonrecord-marshalling">Customizing JsonRecord Marshalling</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#record-metaclass">Record MetaClass</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="property.html"
                        title="previous chapter">Defining Properties - <tt class="docutils literal"><span class="pre">normalize.property</span></tt></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="selector.html"
                        title="next chapter">Referring to components of Records - <tt class="docutils literal"><span class="pre">normalize.selector</span></tt></a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/record.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="selector.html" title="Referring to components of Records - normalize.selector"
             >next</a> |</li>
        <li class="right" >
          <a href="property.html" title="Defining Properties - normalize.property"
             >previous</a> |</li>
        <li><a href="index.html">normalize 0.4.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Sam Vilain, Hearsay Social.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>